<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd" >
<mapper namespace="com.tanghsk.mock.admin.exam.mapper.ExamSubjectStructMapper" >

  <!-- 科目结构 -->
  <resultMap id="BaseResultMap" type="subStru" >
    <id column="subject_struct_id" property="subjectStructId" jdbcType="VARCHAR" />
    <result column="subject_struct_name" property="subjectStructName" jdbcType="VARCHAR" />
    <result column="subject_struct_parent_id" property="subjectStructParentId" jdbcType="VARCHAR" />
    <result column="subject_struct_question_num" property="subjectStructQuestionNum" jdbcType="INTEGER" />
    <result column="subject_struct_answer_time" property="subjectStructAnswerTime" jdbcType="INTEGER" />
    <result column="subject_struct_seq_num" property="subjectStructSeqNum" jdbcType="INTEGER" />
    <result column="subject_struct_level" property="subjectStructLevel" jdbcType="INTEGER" />
    <association property="subject" column="subject_id" javaType="subject" resultMap="subjectMap" />
  </resultMap>
  
  <!-- 科目 -->
  <resultMap id="subjectMap" type="subject">
    <id column="subject_id" property="subject_id" jdbcType="VARCHAR" />
    <result column="exam_status_id" property="exam_status_id" jdbcType="CHAR" />
    <result column="subject_name" property="subject_name" jdbcType="VARCHAR" />
    <result column="subject_question_num" property="subject_question_num" jdbcType="INTEGER" />
    <result column="subject_paper_num" property="subject_paper_num" jdbcType="INTEGER" />
    <result column="subject_remark" property="subject_remark" jdbcType="VARCHAR" />
    <association property="subjectType" column="subject_type" javaType="subType" resultMap="subjectTypeMap" />
  </resultMap>
  
  <!-- 科目类别 -->
  <resultMap id="subjectTypeMap" type="subType">
    	<id property="sub_type_id" column="sub_type_id"/>
    	<result property="sub_type_name" column="sub_type_name"/>
    	<result property="sub_type_remark" column="sub_type_remark"/>
  </resultMap>
  
  <sql id="Base_Column_List" >
    subject_struct_id, subject_id, subject_struct_name, subject_struct_parent_id, subject_struct_question_num, 
    subject_struct_answer_time, subject_struct_seq_num,subject_struct_level,subject_struct_root_id
  </sql>
  
  <!-- 根据科目ID查找科目结构 -->
  <select id="getStruBySubID" resultType="subStru" parameterType="string">
    select * from exam_subject_struct
  	where subject_id=#{subjectId}
  	order by subject_struct_root_id,subject_struct_seq_num,subject_struct_level
  </select>
  <!-- 根据id加载对象 -->
  <select id="getObjectById" resultType="subStru">
  	 select * from exam_subject_struct where subject_struct_id=#{struct_id}
  </select>
  <select id="getAllStructDataBySubject" resultType="subStru" parameterType="string">
  	select * from exam_subject_struct where subject_id=#{subject_id}
  </select>
  
  <!-- 根据科目id加载root Name  -->
  <select id="getRootNameByid" resultType="subStru" parameterType="string">
  	select <include refid="Base_Column_List"/> from exam_subject_struct 
  	where subject_struct_id=(select subject_struct_root_id from exam_subject_struct where subject_struct_id=#{struct_id})
  </select>
  
  <insert id="addSubStru" parameterType="subStru" >
    insert into exam_subject_struct
    <trim prefix="(" suffix=")" suffixOverrides="," >
      subject_struct_id,
      subject_id,
      subject_struct_name,
      subject_struct_parent_id,
      subject_struct_question_num,
      subject_struct_answer_time,
      subject_struct_seq_num,
      subject_struct_level,
      subject_struct_root_id,
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      #{subject_struct_id,jdbcType=VARCHAR},
      #{subject_id,jdbcType=VARCHAR},
      #{subject_struct_name,jdbcType=VARCHAR},
      #{subject_struct_parent_id,jdbcType=VARCHAR},
      #{subject_struct_question_num,jdbcType=INTEGER},
      #{subject_struct_answer_time,jdbcType=INTEGER},
      #{subject_struct_seq_num,jdbcType=INTEGER},
      #{subject_struct_level,jdbcType=INTEGER},
      #{subject_struct_root_id,jdbcType=VARCHAR},
    </trim>
  </insert>
  
  <update id="updateSubStru" parameterType="subStru" >
    update exam_subject_struct
    <set>
      <if test="subject_id != null" >
        subject_id = #{subject_id,jdbcType=VARCHAR},
      </if>
      <if test="subject_struct_name != null" >
        subject_struct_name = #{subject_struct_name,jdbcType=VARCHAR},
      </if>
      <if test="subject_struct_parent_id != null" >
        subject_struct_parent_id = #{subject_struct_parent_id,jdbcType=VARCHAR},
      </if>
      <if test="subject_struct_question_num != null" >
        subject_struct_question_num = #{subject_struct_question_num,jdbcType=INTEGER},
      </if>
      <if test="subject_struct_answer_time != null" >
        subject_struct_answer_time = #{subject_struct_answer_time,jdbcType=INTEGER},
      </if>
      <if test="subject_struct_seq_num != null" >
        subject_struct_seq_num = #{subject_struct_seq_num,jdbcType=INTEGER},
      </if>
      <if test="subject_struct_level != null" >
        subject_struct_level = #{subject_struct_level,jdbcType=INTEGER},
      </if>
    </set>
    where subject_struct_id = #{subject_struct_id,jdbcType=VARCHAR}
  </update>
  <!-- 加载所有子对象 -->
  <select id="getChildList" resultType="subStru" parameterType="subStru">
  	select <include refid="Base_Column_List"/> from exam_subject_struct
  	where subject_struct_parent_id=#{struct_id} and subject_struct_id!=subject_struct_parent_id
  </select>
  <delete id="delStruct" parameterType="string">
  	delete from exam_subject_struct where subject_struct_id=#{struct_id}
  </delete>
  <!-- 加载某个科目类别下的所有数据 -->
  <select id="getXmlPaper" resultType="subStru" parameterType="subStru">
  	select <include refid="Base_Column_List"/> from exam_subject_struct
  	<where>
  		<if test="subject_id!=null">
  			subject_id=#{subject_id,jdbcType=VARCHAR} and subject_struct_level=1
  		</if>
  		<if test="subject_struct_parent_id!=null">
  			and subject_struct_parent_id=#{subject_struct_parent_id,jdbcType=VARCHAR} 
  			and subject_struct_id!=subject_struct_parent_id
  		</if>
  	</where>
  </select>
</mapper>